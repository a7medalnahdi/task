
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª - ÙÙ„ØªØ±Ø©</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@phosphor-icons/web"></script>
  <style>
    body.dark { background-color: #111827; color: white; }
    body.light { background-color: #ffefe5; color: black; }
  </style>
</head>
<body class="dark">
  <div id="app" class="max-w-7xl mx-auto px-4 py-8"></div>

<script>
let tasks = JSON.parse(localStorage.getItem("tasks") || "[]");
let editId = null;
let darkMode = true;
let searchQuery = "";
let selectedDept = "Ø§Ù„ÙƒÙ„";
let selectedStatus = "Ø§Ù„ÙƒÙ„";

const departments = {
  "ÙƒØ±ÙŠÙŠØªÙ": "#a3e635", "Ø³ÙˆØ´Ø§Ù„ Ù…ÙŠØ¯ÙŠØ§": "#f472b6", "Ù…Ø§Ø±ÙƒØªÙ†Ù‚": "#f87171",
  "ÙƒÙˆØ§Ù„ÙŠØªÙŠ": "#fde047", "Ø§Ù„Ø´Ø±Ø§ÙƒØ§Øª": "#34d399", "Ø³ÙˆÙŠØªØ±": "#60a5fa",
  "Ø§ÙˆØ¨Ø±ÙŠØ´Ù†": "#a78bfa", "Ø®Ø¯Ù…Ø© Ø¹Ù…Ù„Ø§Ø¡": "#fb923c", "ØªÙ‚Ù†ÙŠØ©": "#22d3ee"
};

const statuses = {
  "ØºÙŠØ± Ù…Ù†Ø¬Ø²": "#e74c3c", "Ù…Ù†Ø¬Ø²": "#27ae60", "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¹Ù…Ù„": "#3498db",
  "Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø±Ø¯": "#8e44ad", "Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø­ØªÙˆÙ‰": "#f39c12",
  "Ù…Ø¹Ù„Ù‚": "#6e4d2b", "Ù…Ù„ØºÙŠ": "#000", "Ø§Ù‡Ù…ÙŠØ©": "#2ecc71"
};

function render() {
  const bg = darkMode ? 'dark' : 'light';
  const input = darkMode ? 'bg-gray-700 text-white' : 'bg-gray-200 text-black';
  const cardBg = darkMode ? '#1f2937' : '#ffffff';

  document.body.className = bg;

  const filtered = tasks.filter(task =>
    (selectedDept === "Ø§Ù„ÙƒÙ„" || task.department === selectedDept) &&
    (selectedStatus === "Ø§Ù„ÙƒÙ„" || task.status === selectedStatus) &&
    (task.title.includes(searchQuery) || task.requester.includes(searchQuery))
  );

  document.getElementById("app").innerHTML = `
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-2xl font-bold">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h1>
      <button onclick="toggleMode()" class="px-4 py-2 rounded-full bg-[#ef5b0c] text-white">
        ${darkMode ? "Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù†Ù‡Ø§Ø±ÙŠ â˜€ï¸" : "Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ ğŸŒ™"}
      </button>
    </div>

    <div class="bg-gray-800 dark:bg-gray-800 light:bg-white p-4 rounded-xl mb-6 grid grid-cols-1 md:grid-cols-3 gap-4">
      <select onchange="setDept(this.value)" class="p-3 rounded-lg ${input}">
        <option>Ø§Ù„ÙƒÙ„</option>
        ${Object.keys(departments).map(dep => `<option>${dep}</option>`).join('')}
      </select>
      <select onchange="setStatus(this.value)" class="p-3 rounded-lg ${input}">
        <option>Ø§Ù„ÙƒÙ„</option>
        ${Object.keys(statuses).map(s => `<option>${s}</option>`).join('')}
      </select>
      <input oninput="setSearch(this.value)" placeholder="Ø¨Ø­Ø« Ø¨Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø·Ù„Ø¨ Ø£Ùˆ Ø§Ù„Ø§Ø³Ù…" class="p-3 rounded-lg ${input}" />
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-3 gap-6">
      ${filtered.map(task => `
        <div class="p-6 rounded-2xl border shadow-md hover:scale-[1.01] transition"
             style="background: linear-gradient(to bottom, ${hexToRgba(statuses[task.status], 0.2)}, ${cardBg}); border-color: ${darkMode ? '#4b5563' : '#ccc'};">
          <div class="flex justify-between items-center mb-4">
            <span class="px-3 py-1 text-xs font-semibold rounded-full" style="background:${departments[task.department]}; color:#000">${task.department}</span>
            <select onchange="updateStatus(${task.id}, this.value)" class="text-xs font-bold px-3 py-1 rounded-full bg-transparent text-white border border-white">
              ${Object.keys(statuses).map(s => `<option ${s===task.status?"selected":""}>${s}</option>`).join('')}
            </select>
          </div>
          <h2 class="text-lg font-bold mb-2">${task.title}</h2>
          <div class="space-y-1 text-sm ${darkMode ? 'text-gray-300' : 'text-gray-800'}">
            <p>ğŸ‘¤ ${task.requester || "--"}</p>
            <p>ğŸ“ Ø§Ù„Ù…Ù‚Ø§Ø³: ${task.size || "--"}</p>
            <p>ğŸ¨ Ø§Ù„Ù†ÙˆØ¹: ${task.type || "--"}</p>
            <p>ğŸ“… Ø§Ù„ØªØ³Ù„ÙŠÙ…: ${task.deadline || "--"}</p>
            <p>ğŸ”— Ø§Ù„Ø±Ø§Ø¨Ø·: <a href="${task.link}" class="text-blue-400 underline">Ø±Ø§Ø¨Ø·</a></p>
          </div>
          <div class="flex justify-end gap-2 mt-4">
            <button onclick="editTask(${task.id})" class="text-blue-500 text-xl"><i class="ph ph-pencil-simple"></i></button>
            <button onclick="deleteTask(${task.id})" class="text-red-500 text-xl"><i class="ph ph-trash-simple"></i></button>
          </div>
        </div>
      `).join('')}
    </div>
  `;
}

function hexToRgba(hex, alpha) {
  const r = parseInt(hex.slice(1,3), 16);
  const g = parseInt(hex.slice(3,5), 16);
  const b = parseInt(hex.slice(5,7), 16);
  return `rgba(${r}, ${g}, ${b}, ${alpha})`;
}

function val(id) { return document.getElementById(id)?.value || "--"; }

function addTask() {}
function editTask(id) {}
function deleteTask(id) {}
function updateStatus(id, status) {
  tasks = tasks.map(t => t.id === id ? { ...t, status } : t);
  localStorage.setItem("tasks", JSON.stringify(tasks));
  render();
}

function toggleMode() {
  darkMode = !darkMode;
  render();
}

function setSearch(q) {
  searchQuery = q.trim();
  render();
}
function setDept(v) {
  selectedDept = v;
  render();
}
function setStatus(v) {
  selectedStatus = v;
  render();
}

render();
</script>
</body>
</html>
